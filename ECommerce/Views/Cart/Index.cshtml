@model IEnumerable<ECommerce.Models.ProductVM>

@{
    ViewData["Title"] = "Index";
    var orderProducts = ViewData["OrderProductVM"] as List<OrderProductVM>;
    Dictionary<int, double> temp= new Dictionary<int, double>();
    foreach (var prod in orderProducts)
        temp[prod.ProductId] = prod.Quantity;
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Id)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.PriceIsInteger)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ImageUrl)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Unit)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
    <form class="atter atter-temp col-12" id="form-@item.Id" action="" method="post">
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Id)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Description)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Price)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.PriceIsInteger)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Quantity)
            </td>
            <td>
                <img src="@item.ImageUrl" alt="">
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Unit)
            </td>
            <td>
                <label for="totalAmt">Total Amount</label>
                <input name = "quantity" type="number" step="@(item.PriceIsInteger ? 1 : 0.01)" id="totalAmount-@item.Id" value ="@temp.GetValueOrDefault(item.Id)" min="0" max="@item.Quantity">
                <input name = "prod_id" type="number"  value = "@item.Id" hidden readonly>

                <button id="add-@item.Id" class="btn btn-primary rounded submit_btn mt-3">
                    Add    
                </button>
                <script>
                    $(document).ready(function() {
                        $('#add-@item.Id').click(function (e) {
                            id = $(this).attr('id').substr(4)
                            var form = $('#form-'+ id);
                            var obj = form.serializeArray()
                            console.log(obj)
                            e.preventDefault(); 
                            var actionUrl = "Cart/AddToCart";
                            $.ajax({
                                url: actionUrl,
                                type: "POST",
                                data: {
                                    'prod_id': obj[1]['value'],
                                    'quantity':obj[0]['value'], 
                                },
                                success: function (result) {
                                    console.log("first call:" + result);
                                },
                                error: function (xhr, textStatus, error) {
                                    console.log(xhr.statusText);
                                    console.log(textStatus);
                                    console.log(error);
                                }
                            });
                        });
                    })

                    </script>
            </td>
        </tr>
        </form>
}
    </tbody>
</table>


                    
