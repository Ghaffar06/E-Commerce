@model ECommerce.Models.ProductVM

@{
    ViewData["Title"] = "Edit";
}
<link rel="stylesheet" href="~/css/atter.css" />


<script>
    

function reassignment() {
            selected_categories = []
            let all_category_selector = $('#all_category_selector');
            all_category_selector.find('select option:selected').each(
                function () {
                    if ($(this).val() != '0')
                        selected_categories.push({'id': $(this).val(), 'name': $(this).text()})
                }
            )

            all_category_selector.find('select').each(
                function () {
                    let id = $(this).find('option:selected').val();
                    $(this).children().remove();
                    $(this).append(
                        $('<option/>', {
                            'value': '0',
                        }).text('Select a category')
                    );
                    for (let c of categories) {
                        let ok = true;
                        for (let sc of selected_categories) {
                            if (sc['id'] == c['id']) {
                                ok = false;
                            }
                        }
                        if (id == c['id'])
                            ok = true;
                        if (ok) {
                            $(this).append(
                                $('<option/>', {
                                    'value': c['id'],
                                    'selected': (id == c['id'])
                                }).text(c['name'])
                            );
                        }
                    }
                }
            )
        }

        function add_new_category_selector() {
            $('#all_category_selector').append(
                $('<div/>', {
                    'class': "d-flex align-items-center mb--20"
                }).append(
                    $('<select/>'),
                    $('<h2/>', {
                        'class': 'dcare__btn'
                    }).append(
                        $('<i/>', {
                            'class': "fa fa-trash",
                            'aria-hidden': true
                        })
                    ).on('click', (e) => {
                        e.currentTarget.parentNode.remove()
                        reassignment();
                    })
                )
            ).on('change', () => reassignment());
            reassignment();
        }

    let categories = []
    let selected_categories = []
    //    categories.push({'name': "{{$cate->title}}", 'id': {{$cate->id}}});
</script>

                            
<h1 class="mt-3">Edit Category</h1>

<hr />

<div class="container">
    <div class="row">
        <input type="hidden" name="count" value="1" />
        <div class="control-group" id="fields">
            <div class="controls" id="profs">
                
                <div class="row d-flex align-items-baseline">
                
                    <form asp-action="EditCategory" class="input-append col-lg-6 col-sm-12 d-flex" 
                        style="flex-direction:column" id="basic-form">
                        
                        <div id="field11" class="d-flex justify-content-center" style="flex-direction:column">

                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <div class="form-group">
                                <label asp-for="Name" class="col-form-label mt-4"></label>
                                <input asp-for="Name" class="form-control" disabled=""/>
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Description" class="col-form-label mt-4"></label>
                                <input asp-for="Description" class="form-control" />
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>

                             <div class="form-group">
                                <label asp-for="Price" class="col-form-label mt-4"></label>
                                <input asp-for="Price" type="number" class="form-control" min="1"  
                                    placeholder="bigger than 0">
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Quantity" class="col-form-label mt-4"></label>
                                <input asp-for="Quantity" type="number" class="form-control" min="0"  
                                    placeholder="bigger than 0">
                                <span asp-validation-for="Quantity" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Unit" class="col-form-label mt-4"></label>
                                <input asp-for="Unit" type="text" class="form-control" 
                                    placeholder="like item,piece,etc">
                                <span asp-validation-for="Unit" class="text-danger"></span>
                            </div>
                        

                            <div class="form-group" id="image_input">
                                <label asp-for="ImageUrl" class="col-form-label mt-4"></label>
                                <input asp-for="ImageUrl" type="file" id="Image_url" 
                                    class="form-control add_file_btn" hidden>
                                <div class="d-flex align-items-center">
                                    <div id='image' class="btn btn-outline-primary rounded">Select File</div>
                                    <div id='val' style="margin-left:10px"></div>
                                </div>
                                <span asp-validation-for="ImageUrl" class="text-danger"></span>
                            </div>
                        </div>
                    </form>

                    <div class="d-flex justify-content-center align-items-center col-lg-6 col-sm-12"
                        style="flex-direction:column">
                        <div class="container"></div>
                        <div id="add_cat" class="btn btn-primary rounded add_atter_btn mt-3"
                            onclick="add_new_category_selector()">
                            <i class="bi bi-plus-circle-fill"></i> Add Category
                        </div>
                        <div class="col-6 mb--20" id="all_category_selector">
                            <div class="d-flex justify-content-between align-items-center mb--20">
                            </div>
                        </div>              
                    </div>
            </div>

            <div class="form-group d-flex justify-content-center">
                <button id="submit-basicForm"class="btn btn-primary rounded submit_btn mt-3">
                    Save    
                </button>
            </div>   
            <br>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#submit-basicForm').click(function() {
        $('#basic-form').submit();
    })
})
</script>